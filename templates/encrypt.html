{% extends "layout.html" %}

{% block title %}
    Encrypt
{% endblock %}

{% block main %}
    <form action="/encrypt" method="post" enctype="multipart/form-data">
        <div class="mb-3">
            <label for="img">Select image:</label>
            <input type="file" id="img" name="img" accept="image/*">
        </div>
        <div class="mb-3">
            <input autocomplete="off" type="text" id="filename" name="filename" placeholder="Image Name" required>
        </div>
        <span id="charCount">Upload the image to see character limit</span>
        <div class="mb-3">
            <label for="msg">Message:</label>
            <input autocomplete="off" type="text" id="msg" name="msg" disabled required>

            <script>
                const fileInput = document.getElementById('img');
                const msgInput = document.getElementById('msg');
                const charCount = document.getElementById('charCount');
            
                fileInput.addEventListener('change', function () {
                    if (this.files.length > 0) {
                        // Upload the image and get the image size asynchronously
                        const formData = new FormData();
                        formData.append('img', this.files[0]);
            
                        fetch('/get_image_size', {
                            method: 'POST',
                            body: formData
                        })
                        .then(response => response.json())
                        .then(data => {
                            const image_size = data.image_size;
                            // Update maxCharacters with the received image_size
                            const maxCharacters = image_size;
            
                            msgInput.removeAttribute('disabled');
                            updateCharCount();
            
                            // Function to update character count
                            function updateCharCount() {
                                const currentLength = msgInput.value.length;
                                charCount.textContent = currentLength + '/' + maxCharacters;
                            }
                            
                            // Add an event listener to the input field to track changes
                            msgInput.addEventListener('input', updateCharCount);
                        });
                    } else {
                        msgInput.setAttribute('disabled', 'disabled');
                        charCount.textContent = '0/0';
                    }
                });
            </script>
            

        </div>
        <button class="btn btn-primary" type="submit">Encrypt</button>
    </form>
{% endblock %}
