{% extends "layout.html" %}

{% block title %}
    Encrypt
{% endblock %}

{% block main %}
    <form action="/encrypt" method="post" enctype="multipart/form-data">
        <div class="mb-3">
            <label for="img" class="form-label">Select image:</label>
            <input type="file" id="img" name="img" accept="image/*" required class="form-control">
        </div>
        <div class="mb-3">
            <input autocomplete="off" type="text" id="filename" name="filename" placeholder="Image Name" required class="form-control">
        </div>
        <span id="charCount">Upload the image to see character limit</span>
        <div class="mb-3">
            <label for="msg" class="form-label">Message:</label>
            <input autocomplete="off" type="text" id="msg" name="msg" disabled required class="form-control">

            <script>
                const fileInput = document.getElementById('img');
                const msgInput = document.getElementById('msg');
                const charCount = document.getElementById('charCount');
            
                fileInput.addEventListener('change', function () {
                    if (this.files.length > 0) {
                        // Upload the image and get the image size asynchronously
                        const formData = new FormData();
                        formData.append('img', this.files[0]);
            
                        fetch('/get_image_size', {
                            method: 'POST',
                            body: formData
                        })
                        .then(response => response.json())
                        .then(data => {
                            const image_size = data.image_size;
                            // Update maxCharacters with the received image_size
                            const maxCharacters = image_size;
            
                            msgInput.removeAttribute('disabled');
                            updateCharCount();
            
                            // Function to update character count
                            function updateCharCount() {
                                const currentLength = msgInput.value.length;
                                charCount.textContent = currentLength + '/' + maxCharacters;
                            }
                            
                            // Add an event listener to the input field to track changes
                            msgInput.addEventListener('input', updateCharCount);
                        });
                    } else {
                        msgInput.setAttribute('disabled', 'disabled');
                        charCount.textContent = '0/0';
                    }
                });
            </script>

        </div>
        <div class="mb-3">
            <select class="form-select mx-auto w-auto" id="cipher" name="cipher" required>
                <option disabled selected>Cipher</option>
                <option value="replace">Replace</option>
                <option value="cipher2">Cipher 2</option>
                <option value="cipher3">Cipher 3</option>
            </select>
        </div>

        <div id="Cipher1" class="hidden mb-3">
            <div class="mb-3">
                <input autocomplete="off" type="text" id="find" name="find" placeholder="Find" required class="form-control">
            </div>
            <div class="mb-3">
                <input autocomplete="off" type="text" id="replace" name="replace" placeholder="Replace" required class="form-control">
            </div>
            <div>
                <p>Case Sensitivity</p>
                <input class="form-check-input" type="radio" name="option" id="option1" value="Yes">
                <label class="form-check-label" for="option1">
                    Yes
                </label>
            </div>
            <div>
                <input class="form-check-input" type="radio" name="option" id="option2" value="No" checked>
                <label class="form-check-label" for="option2">
                    No
                </label>
            </div>
        </div>

        <div id="Cipher2" class="hidden mb-3">This is Cipher 2</div>

        <div id="Cipher3" class="hidden mb-3">This is Cipher 3</div>

        <script>
            // Get a reference to the select element
            var selectElement = document.getElementById("cipher");

            // Get references to the div elements you want to show/hide
            var Cipher1 = document.getElementById("Cipher1");
            var Cipher2 = document.getElementById("Cipher2");
            var Cipher3 = document.getElementById("Cipher3");

            // Hide all div elements initially
            Cipher1.style.display = "none";
            Cipher2.style.display = "none";
            Cipher3.style.display = "none";

            // Add an event listener to the select element
            selectElement.addEventListener("change", function () {
                // Restart all div elements
                Cipher1.style.display = "none";
                Cipher2.style.display = "none";
                Cipher3.style.display = "none";

                // Get the selected option
                var selectedOption = selectElement.value;

                // Show the corresponding div element based on the selected option
                if (selectedOption === "replace") {
                    Cipher1.style.display = "block";
                } else if (selectedOption === "cipher2") {
                    Cipher2.style.display = "block";
                } else if (selectedOption === "cipher3") {
                    Cipher3.style.display = "block";
                }
            });
        </script>

        <button class="btn btn-primary" type="submit">Encrypt</button>
    </form>
{% endblock %}